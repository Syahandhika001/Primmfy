package main

import (
    "fmt"
    "log"
    
    "github.com/joho/godotenv"  // ğŸ‘ˆ TAMBAHKAN INI
    "primmfy_db/services"
)

func main() {
    // ğŸ‘‡ TAMBAHKAN INI - Load .env file
    err := godotenv.Load()
    if err != nil {
        log.Fatal("âŒ Error loading .env file:", err)
    }
    fmt.Println("âœ… File .env berhasil dimuat!")
    fmt.Println()

    fmt.Println("ğŸ§ª Testing Auth Service...")
    fmt.Println("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•")

    // 1. Test Password Hashing
    password := "password123"
    fmt.Printf("ğŸ“ Password original: %s\n", password)

    // Hash password
    hashedPassword, err := services.HashPassword(password)
    if err != nil {
        fmt.Println("âŒ Error hashing password:", err)
        return
    }

    fmt.Printf("ğŸ”’ Password hash: %s\n", hashedPassword)
    fmt.Printf("ğŸ“ Length hash: %d characters\n\n", len(hashedPassword))

    // 2. Test Password Verification
    fmt.Println("ğŸ” Testing Password Verification...")

    // Test dengan password yang benar
    isValid := services.CheckPasswordHash(password, hashedPassword)
    if isValid {
        fmt.Println("âœ… Password BENAR - Cocok!")
    } else {
        fmt.Println("âŒ Password SALAH - Tidak cocok!")
    }

    // Test dengan password yang salah
    wrongPassword := "wrongpassword"
    isValid = services.CheckPasswordHash(wrongPassword, hashedPassword)
    if isValid {
        fmt.Println("âœ… Password BENAR - Cocok!")
    } else {
        fmt.Println("âŒ Password SALAH - Tidak cocok! (ini hasil yang diharapkan)")
    }

    fmt.Println("\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•")

    // 3. Test JWT Generation
    fmt.Println("ğŸ« Testing JWT Token Generation...")

    token, err := services.GenerateJWT(1, "student")
    if err != nil {
        fmt.Println("âŒ Error generating token:", err)
        return
    }

    fmt.Printf("ğŸŸï¸  JWT Token: %s\n", token)
    fmt.Printf("ğŸ“ Token length: %d characters\n\n", len(token))

    // 4. Test JWT Validation
    fmt.Println("ğŸ” Testing JWT Token Validation...")

    claims, err := services.ValidateJWT(token)
    if err != nil {
        fmt.Println("âŒ Error validating token:", err)
        return
    }

    fmt.Printf("âœ… Token valid!\n")
    fmt.Printf("   User ID: %d\n", claims.UserID)
    fmt.Printf("   Role: %s\n", claims.Role)
    fmt.Printf("   Expires: %s\n", claims.ExpiresAt.Time.Format("2006-01-02 15:04:05"))

    fmt.Println("\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•")
    fmt.Println("âœ… All tests passed!")
}